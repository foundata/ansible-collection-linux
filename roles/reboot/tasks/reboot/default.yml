# Reboot: Manage and execute immediate reboots

---

- name: "Reboot | Default | Reboot system if needed"
  ansible.builtin.reboot:
    boot_time_command: "{{ reboot_linux_boot_time_cmd }}"
    connect_timeout: "{{ reboot_linux_connect_timeout if reboot_linux_connect_timeout > 0 else omit }}"
    msg: "{{ reboot_linux_msg }}"
    post_reboot_delay: "{{ reboot_linux_post_delay }}"
    reboot_timeout: "{{ reboot_linux_timeout }}"
    test_command: "{{ reboot_linux_test_cmd }}"
  when:
    - __reboot_linux_required
  register: __reboot_linux_reboot_result


- name: "Reboot | Default | Set fact with reboot result data (rebooted, elapsed)"
  ansible.builtin.set_fact:
    # Remember to update the fact task in handlers/main.yaml if this changes
    reboot_linux_result:
      # seconds that elapsed waiting for the system to be rebooted
      elapsed: "{{ __reboot_linux_reboot_result['elapsed'] | default(false) }}"
      # true if the machine was rebooted
      rebooted: "{{ __reboot_linux_reboot_result['rebooted'] | default(0) }}"
