# Role argument validation.
#
# See defaults/main.yml for details on each variable. For more information on
# the argument_specs.yml format, refer to the official Ansible documentation:
# https://docs.ansible.com/ansible/latest/playbook_guide/playbooks_reuse_roles.html#role-argument-validation

---

argument_specs:

  # foundata.linux/roles/run/tasks/main.yml entry point
  main:
    short_description: "Main entry point for the foundata.linux.sysctl role"
    options:

      sysctl_linux_state:
        description: |
          Determines whether the managed resources should be `present` or `absent`.

          `present` ensures that required components, such as software packages, are
          installed and configured.

          `absent` reverts changes as much as possible, such as removing packages,
          deleting created users, stopping services, restoring modified settings, â€¦

          Note: For this role, the required component and package set is minimal. There
          are no users or services to manage and the components needed to set kernel
          parameter are preinstalled even on hardened systems. They also cannot be
          safely removed due to dependencies, so the role rarely modifies the system
          in this regard.
        type: "str"
        default: "present"
        choices:
          - "present"
          - "absent"

      sysctl_linux_autoupgrade:
        description: |
          If set to `true`, all managed packages will be upgraded during each Ansible
          run (e.g., when the package provider detects a newer version than the
          currently installed one).
        type: "bool"
        default: false

      sysctl_linux_parameters:
        description: |
          Dictionary of kernel parameters to manage via sysctl. Keys are parameter
          names (e.g., `net.ipv4.ip_forward`), values are the desired settings.

          Setting a value to `null` or an empty string removes the parameter from
          the managed drop-in configuration file, reverting to the kernel default.

          Example:

          ```yaml
          sysctl_linux_parameters:
            "net.ipv4.ip_forward": null # use kernel default, remove
            "vm.swappiness": 5
          ```
        type: "dict"
        required: true

      sysctl_linux_reload:
        description: |
          If set to `true`, triggers `sysctl --system` after configuration changes
          to reload all sysctl configuration files following the proper precedence
          order. This ensures all drop-in files and the main configuration are
          applied consistently.

          Set to `false` in container environments where `sysctl --system` may fail
          due to read-only kernel parameters.
        type: "bool"
        default: true

      sysctl_linux_verify:
        description: |
          If set to `true`, verifies the parameter value using the sysctl command
          and actively sets it in the running kernel using `sysctl -w` if the
          current value differs from the desired one.

          When `false`, only writes the parameter to the configuration file without
          verifying or immediately applying it to the running kernel.
        type: "bool"
        default: true

      sysctl_linux_ignore_unknown_key_errors:
        description: |
          If set to `true`, ignores errors caused by unknown or unsupported kernel
          parameter keys. This is useful in container environments where certain
          parameters may not exist or be accessible.

          Generally not recommended for bare-metal or VM deployments where all
          expected parameters should be available.
        type: "bool"
        default: false
